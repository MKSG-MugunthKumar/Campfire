package app.campfire.data.mapping.model

import app.campfire.core.model.MediaType
import app.campfire.core.util.createIfNotNull

/**
 * This is a common representation of the data from the [libraryItem] sql table
 * for a query that has been joined with [media] table to form the core information
 * model of a library item.
 *
 * We have various queries for pulling library items for various sources (by id, by series, by author, etc)
 * and instead of having N-mapping functions we should commonize those into this central data class representation
 * for easier more consistent mapping
 */
data class LibraryItemWithMedia(
  val id: String,
  val ino: String,
  val libraryId: String,
  val oldLibraryItemId: String?,
  val folderId: String,
  val path: String,
  val relPath: String,
  val isFile: Boolean,
  val mtimeMs: Long,
  val ctimeMs: Long,
  val birthtimeMs: Long,
  val addedAt: Long,
  val updatedAt: Long,
  val isMissing: Boolean,
  val isInvalid: Boolean,
  val mediaType: MediaType,
  val numFiles: Int,
  val size: Long,
  val serverUrl: String,
  val mediaId: String,
  val coverPath: String?,
  val tags: List<String>?,
  val numTracks: Int,
  val numAudioFiles: Int,
  val numChapters: Int,
  val numMissingParts: Int,
  val numInvalidAudioFiles: Int,
  val durationInMillis: Long,
  val sizeInBytes: Long,
  val propertySize: Int?,
  val ebookFormat: String?,
  val metadata_title: String?,
  val metadata_subtitle: String?,
  val metadata_genres: List<String>?,
  val metadata_publishedYear: String?,
  val metadata_publishedDate: String?,
  val metadata_publisher: String?,
  val metadata_description: String?,
  val metadata_isbn: String?,
  val metadata_asin: String?,
  val metadata_language: String?,
  val metadata_explicit: Boolean,
  val metadata_abridged: Boolean,
  val metadata_titleIgnorePrefix: String?,
  val metadata_authorName: String?,
  val metadata_authorNameLF: String?,
  val metadata_narratorName: String?,
  val metadata_seriesName: String?,
  val metadata_series_id: String?,
  val metadata_series_name: String?,
  val metadata_series_sequence: Int?,
  val libraryItemId: String,
  val userMediaProgress: LibraryItemProgress? = null,
)

data class LibraryItemProgress(
  val id: String,
  val libraryItemId: String,
  val userId: String,
  val episodeId: String?,
  val mediaItemId: String,
  val mediaItemType: MediaType,
  val duration: Double,
  val progress: Double,
  val currentTime: Double,
  val isFinished: Boolean,
  val hideFromContinueListening: Boolean,
  val ebookLocation: String?,
  val ebookProgress: Double?,
  val lastUpdate: Long,
  val startedAt: Long,
  val finishedAt: Long?,
)

fun mapToLibraryItem(
  id: String,
  ino: String,
  libraryId: String,
  oldLibraryItemId: String?,
  folderId: String,
  path: String,
  relPath: String,
  isFile: Boolean,
  mtimeMs: Long,
  ctimeMs: Long,
  birthtimeMs: Long,
  addedAt: Long,
  updatedAt: Long,
  isMissing: Boolean,
  isInvalid: Boolean,
  mediaType: MediaType,
  numFiles: Int,
  size: Long,
  serverUrl: String,
  mediaId: String,
  coverPath: String?,
  tags: List<String>?,
  numTracks: Int,
  numAudioFiles: Int,
  numChapters: Int,
  numMissingParts: Int,
  numInvalidAudioFiles: Int,
  durationInMillis: Long,
  sizeInBytes: Long,
  propertySize: Int?,
  ebookFormat: String?,
  metadata_title: String?,
  metadata_subtitle: String?,
  metadata_genres: List<String>?,
  metadata_publishedYear: String?,
  metadata_publishedDate: String?,
  metadata_publisher: String?,
  metadata_description: String?,
  metadata_isbn: String?,
  metadata_asin: String?,
  metadata_language: String?,
  metadata_explicit: Boolean,
  metadata_abridged: Boolean,
  metadata_titleIgnorePrefix: String?,
  metadata_authorName: String?,
  metadata_authorNameLF: String?,
  metadata_narratorName: String?,
  metadata_seriesName: String?,
  metadata_series_id: String?,
  metadata_series_name: String?,
  metadata_series_sequence: Int?,
  libraryItemId: String,
): LibraryItemWithMedia = LibraryItemWithMedia(
  id = id,
  ino = ino,
  libraryId = libraryId,
  oldLibraryItemId = oldLibraryItemId,
  folderId = folderId,
  path = path,
  relPath = relPath,
  isFile = isFile,
  mtimeMs = mtimeMs,
  ctimeMs = ctimeMs,
  birthtimeMs = birthtimeMs,
  addedAt = addedAt,
  updatedAt = updatedAt,
  isMissing = isMissing,
  isInvalid = isInvalid,
  mediaType = mediaType,
  numFiles = numFiles,
  size = size,
  serverUrl = serverUrl,
  mediaId = mediaId,
  coverPath = coverPath,
  tags = tags,
  numTracks = numTracks,
  numAudioFiles = numAudioFiles,
  numChapters = numChapters,
  numMissingParts = numMissingParts,
  numInvalidAudioFiles = numInvalidAudioFiles,
  durationInMillis = durationInMillis,
  sizeInBytes = sizeInBytes,
  propertySize = propertySize,
  ebookFormat = ebookFormat,
  metadata_title = metadata_title,
  metadata_subtitle = metadata_subtitle,
  metadata_genres = metadata_genres,
  metadata_publishedYear = metadata_publishedYear,
  metadata_publishedDate = metadata_publishedDate,
  metadata_publisher = metadata_publisher,
  metadata_description = metadata_description,
  metadata_isbn = metadata_isbn,
  metadata_asin = metadata_asin,
  metadata_language = metadata_language,
  metadata_explicit = metadata_explicit,
  metadata_abridged = metadata_abridged,
  metadata_titleIgnorePrefix = metadata_titleIgnorePrefix,
  metadata_authorName = metadata_authorName,
  metadata_authorNameLF = metadata_authorNameLF,
  metadata_narratorName = metadata_narratorName,
  metadata_seriesName = metadata_seriesName,
  metadata_series_id = metadata_series_id,
  metadata_series_name = metadata_series_name,
  metadata_series_sequence = metadata_series_sequence,
  libraryItemId = libraryItemId,
)

fun mapToLibraryItemWithProgress(
  id: String,
  ino: String,
  libraryId: String,
  oldLibraryItemId: String?,
  folderId: String,
  path: String,
  relPath: String,
  isFile: Boolean,
  mtimeMs: Long,
  ctimeMs: Long,
  birthtimeMs: Long,
  addedAt: Long,
  updatedAt: Long,
  isMissing: Boolean,
  isInvalid: Boolean,
  mediaType: MediaType,
  numFiles: Int,
  size: Long,
  serverUrl: String,
  mediaId: String,
  coverPath: String?,
  tags: List<String>?,
  numTracks: Int,
  numAudioFiles: Int,
  numChapters: Int,
  numMissingParts: Int,
  numInvalidAudioFiles: Int,
  durationInMillis: Long,
  sizeInBytes: Long,
  propertySize: Int?,
  ebookFormat: String?,
  metadata_title: String?,
  metadata_subtitle: String?,
  metadata_genres: List<String>?,
  metadata_publishedYear: String?,
  metadata_publishedDate: String?,
  metadata_publisher: String?,
  metadata_description: String?,
  metadata_isbn: String?,
  metadata_asin: String?,
  metadata_language: String?,
  metadata_explicit: Boolean,
  metadata_abridged: Boolean,
  metadata_titleIgnorePrefix: String?,
  metadata_authorName: String?,
  metadata_authorNameLF: String?,
  metadata_narratorName: String?,
  metadata_seriesName: String?,
  metadata_series_id: String?,
  metadata_series_name: String?,
  metadata_series_sequence: Int?,
  libraryItemId: String,
  id_: String?,
  libraryItemId_: String?,
  userId: String?,
  episodeId: String?,
  mediaItemId: String?,
  mediaItemType: MediaType?,
  duration: Double?,
  progress: Double?,
  currentTime: Double?,
  isFinished: Boolean?,
  hideFromContinueListening: Boolean?,
  ebookLocation: String?,
  ebookProgress: Double?,
  lastUpdate: Long?,
  startedAt: Long?,
  finishedAt: Long?,
): LibraryItemWithMedia = LibraryItemWithMedia(
  id = id,
  ino = ino,
  libraryId = libraryId,
  oldLibraryItemId = oldLibraryItemId,
  folderId = folderId,
  path = path,
  relPath = relPath,
  isFile = isFile,
  mtimeMs = mtimeMs,
  ctimeMs = ctimeMs,
  birthtimeMs = birthtimeMs,
  addedAt = addedAt,
  updatedAt = updatedAt,
  isMissing = isMissing,
  isInvalid = isInvalid,
  mediaType = mediaType,
  numFiles = numFiles,
  size = size,
  serverUrl = serverUrl,
  mediaId = mediaId,
  coverPath = coverPath,
  tags = tags,
  numTracks = numTracks,
  numAudioFiles = numAudioFiles,
  numChapters = numChapters,
  numMissingParts = numMissingParts,
  numInvalidAudioFiles = numInvalidAudioFiles,
  durationInMillis = durationInMillis,
  sizeInBytes = sizeInBytes,
  propertySize = propertySize,
  ebookFormat = ebookFormat,
  metadata_title = metadata_title,
  metadata_subtitle = metadata_subtitle,
  metadata_genres = metadata_genres,
  metadata_publishedYear = metadata_publishedYear,
  metadata_publishedDate = metadata_publishedDate,
  metadata_publisher = metadata_publisher,
  metadata_description = metadata_description,
  metadata_isbn = metadata_isbn,
  metadata_asin = metadata_asin,
  metadata_language = metadata_language,
  metadata_explicit = metadata_explicit,
  metadata_abridged = metadata_abridged,
  metadata_titleIgnorePrefix = metadata_titleIgnorePrefix,
  metadata_authorName = metadata_authorName,
  metadata_authorNameLF = metadata_authorNameLF,
  metadata_narratorName = metadata_narratorName,
  metadata_seriesName = metadata_seriesName,
  metadata_series_id = metadata_series_id,
  metadata_series_name = metadata_series_name,
  metadata_series_sequence = metadata_series_sequence,
  libraryItemId = libraryItemId,
  userMediaProgress = createIfNotNull(
    id_,
    libraryItemId_,
    userId,
    episodeId,
    mediaItemId,
    mediaItemType,
    duration,
    progress,
    currentTime,
    isFinished,
    hideFromContinueListening,
    lastUpdate,
    startedAt,
  ) {
    LibraryItemProgress(
      id = id_!!,
      libraryItemId = libraryItemId_!!,
      userId = userId!!,
      episodeId = episodeId,
      mediaItemId = mediaItemId!!,
      mediaItemType = mediaItemType!!,
      duration = duration!!,
      progress = progress!!,
      currentTime = currentTime!!,
      isFinished = isFinished!!,
      hideFromContinueListening = hideFromContinueListening!!,
      ebookLocation = ebookLocation,
      ebookProgress = ebookProgress,
      lastUpdate = lastUpdate!!,
      startedAt = startedAt!!,
      finishedAt = finishedAt,
    )
  },
)
