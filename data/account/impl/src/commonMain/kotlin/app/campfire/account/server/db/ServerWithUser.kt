package app.campfire.account.server.db

import app.campfire.core.model.Server
import app.campfire.core.model.Tent
import app.campfire.core.model.User

data class ServerWithUser(
  val url: String,
  val userId: String,
  val name: String,
  val tent: Tent,
  val scannerFindCovers: Boolean,
  val scannerCoverProvider: String,
  val scannerParseSubtitle: Boolean,
  val scannerPreferMatchedMetadata: Boolean,
  val scannerDisableWatcher: Boolean,
  val storeCoverWithItem: Boolean,
  val storeMetadataWithItem: Boolean,
  val metadataFileFormat: String,
  val rateLimitLoginRequests: Int,
  val rateLimitLoginWindow: Long,
  val backupSchedule: String,
  val backupsToKeep: Int,
  val maxBackupSize: Int,
  val loggerDailyLogsToKeep: Int,
  val loggerScannerLogsToKeep: Int,
  val homeBookshelfView: Int,
  val bookshelfView: Int,
  val sortingIgnorePrefix: Boolean,
  val sortingPrefixes: List<String>,
  val chromecastEnabled: Boolean,
  val dateFormat: String,
  val timeFormat: String,
  val language: String,
  val logLevel: Int,
  val version: String,
  val id: String,
  val name_: String,
  val type: User.Type,
  val seriesHideFromContinueListening: List<String>,
  val isActive: Boolean?,
  val isLocked: Boolean?,
  val lastSeen: Long?,
  val createdAt: Long,
  val permission_download: Boolean?,
  val permission_update: Boolean?,
  val permission_delete: Boolean?,
  val permission_upload: Boolean?,
  val permission_accessAllLibraries: Boolean?,
  val permission_accessAllTags: Boolean?,
  val permission_accessExplicitContent: Boolean?,
  val librariesAccessible: List<String>,
  val itemTagsAccessible: List<String>,
  val selectedLibraryId: String,
  val serverUrl: String,
) {
  fun asDomainModel(): Server {
    return Server(
      url = url,
      user = User(
        id = id,
        name = name_,
        selectedLibraryId = selectedLibraryId,
        type = type,
        isActive = isActive == true,
        isLocked = isLocked == true,
        lastSeen = lastSeen ?: -1L,
        createdAt = createdAt,
        serverUrl = serverUrl,
        permissions = User.Permissions(
          download = permission_download == true,
          update = permission_update == true,
          delete = permission_delete == true,
          upload = permission_upload == true,
          accessAllLibraries = permission_accessAllLibraries == true,
          accessAllTags = permission_accessAllTags == true,
          accessExplicitContent = permission_accessExplicitContent == true,
        ),
      ),
      name = name,
      tent = tent,
      settings = Server.Settings(
        scannerFindCovers = scannerFindCovers,
        scannerCoverProvider = scannerCoverProvider,
        scannerParseSubtitle = scannerParseSubtitle,
        scannerPreferMatchedMetadata = scannerPreferMatchedMetadata,
        scannerDisableWatcher = scannerDisableWatcher,
        storeCoverWithItem = storeCoverWithItem,
        storeMetadataWithItem = storeMetadataWithItem,
        metadataFileFormat = metadataFileFormat,
        rateLimitLoginRequests = rateLimitLoginRequests,
        rateLimitLoginWindow = rateLimitLoginWindow.toInt(),
        backupSchedule = backupSchedule,
        backupsToKeep = backupsToKeep,
        maxBackupSize = maxBackupSize,
        loggerDailyLogsToKeep = loggerDailyLogsToKeep,
        loggerScannerLogsToKeep = loggerScannerLogsToKeep,
        homeBookshelfView = homeBookshelfView,
        bookshelfView = bookshelfView,
        sortingIgnorePrefix = sortingIgnorePrefix,
        sortingPrefixes = sortingPrefixes,
        chromecastEnabled = chromecastEnabled,
        dateFormat = dateFormat,
        timeFormat = timeFormat,
        language = language,
        logLevel = logLevel,
        version = version,
      ),
    )
  }
}
